<ion-content class="profile-content">
  
  <div class="header-section">
    <div class="background-image">
      <img src="assets/image/superior_gris.png" alt="Background" class="superior-gris">
    </div>
    
    <ion-button fill="clear" (click)="goBack()" class="back-button">
      <ion-icon name="chevron-back"></ion-icon>
    </ion-button>
    
    <div class="profile-header">
      <div class="avatar-container" (click)="changeAvatar()">
        <img [src]="user.avatar" alt="Avatar" class="avatar-image">
        <div class="avatar-edit-badge">
          <ion-icon name="camera"></ion-icon>
        </div>
      </div>
      <h1>{{ user.nombre }}</h1>
      <p class="user-email">{{ user.email }}</p>
      <button class="edit-profile-btn" (click)="editProfile()">
        <ion-icon name="create"></ion-icon>
        Editar Perfil
      </button>
    </div>
  </div>

  <div class="scrollable-content">

    <div class="quick-stats">
      <div class="stat-box">
        <ion-icon name="flame" class="stat-icon streak"></ion-icon>
        <h3>{{ stats.racha_dias_actual }}</h3>
        <p>días de racha</p>
      </div>
      <div class="stat-box">
        <ion-icon name="trophy" class="stat-icon trophy"></ion-icon>
        <h3>{{ stats.total_tests }}</h3>
        <p>sesiones</p>
      </div>
      <div class="stat-box">
        <ion-icon name="time" class="stat-icon time"></ion-icon>
        <h3>{{ stats.total_dias_estudiados }}</h3>
        <p>días estudiando</p>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title">Información Personal</h2>
      
      <div class="info-card">
        <div class="info-item">
          <ion-icon name="person"></ion-icon>
          <div class="info-text">
            <span class="info-label">Nombre Completo</span>
            <span class="info-value">{{ user.nombre }}</span>
          </div>
        </div>
        
        <div class="info-item">
          <ion-icon name="mail"></ion-icon>
          <div class="info-text">
            <span class="info-label">Email</span>
            <span class="info-value">{{ user.email }}</span>
          </div>
        </div>
        
        <div class="info-item">
          <ion-icon name="trending-up"></ion-icon>
          <div class="info-text">
            <span class="info-label">Nivel Actual</span>
            <span class="info-value">{{ getNivelFormatted() }}</span>
          </div>
        </div>
        
        <div class="info-item">
          <ion-icon name="checkmark-circle"></ion-icon>
          <div class="info-text">
            <span class="info-label">Miembro desde</span>
            <span class="info-value">{{ getFechaRegistroFormatted() }}</span>
          </div>
        </div>
      </div>
    </div>

<!-- ============================================ -->
<!-- SECCIÓN MODO ADAPTATIVO (VERSIÓN SIMPLE) -->
<!-- ============================================ -->

<ion-card class="settings-card">
  <ion-card-header>
    <div class="card-header-with-icon">
      <ion-icon name="analytics-outline" color="primary"></ion-icon>
      <ion-card-title>Modo Adaptativo</ion-card-title>
    </div>
    <ion-card-subtitle>
      Sistema inteligente de aprendizaje personalizado
    </ion-card-subtitle>
  </ion-card-header>

  <ion-card-content>
    <!-- Toggle Modo Adaptativo -->
    <div class="setting-item">
      <div class="setting-info">
        <div class="setting-label">
          <ion-icon name="trending-up-outline" color="success"></ion-icon>
          <span>Activar Modo Adaptativo</span>
        </div>
        <div class="setting-description">
          El sistema analizará tu desempeño y priorizará preguntas de temas donde necesitas refuerzo
        </div>
      </div>
      <ion-toggle 
        [(ngModel)]="adaptiveConfig.enabled" 
        (ionChange)="onAdaptiveModeChange()"
        color="success">
      </ion-toggle>
    </div>

    <!-- Información cuando está activo -->
    <div *ngIf="adaptiveConfig.enabled" class="adaptive-info">
      <ion-note color="success">
        <ion-icon name="checkmark-circle-outline"></ion-icon>
        <div>
          <strong>Modo Adaptativo Activo</strong>
          <p>
            Tus próximas sesiones de estudio incluirán más preguntas de los temas 
            donde has tenido dificultades, ayudándote a mejorar de forma más eficiente.
          </p>
        </div>
      </ion-note>
    </div>

    <!-- Información cuando está desactivado -->
    <div *ngIf="!adaptiveConfig.enabled" class="adaptive-info-disabled">
      <ion-note color="medium">
        <ion-icon name="information-circle-outline"></ion-icon>
        <div>
          Activa el modo adaptativo para recibir preguntas personalizadas basadas en tu rendimiento.
        </div>
      </ion-note>
    </div>
  </ion-card-content>
</ion-card>


<!-- ============================================ -->
<!-- FRECUENCIA DE ESTUDIO -->
<!-- ============================================ -->
<div class="section">
  <h2 class="section-title">Frecuencia de Estudio</h2>
  
  <div class="info-card">
    
    <!-- Objetivo Semanal -->
    <div class="frequency-header">
      <ion-icon name="calendar-outline" class="frequency-icon"></ion-icon>
      <div class="frequency-info">
        <h3>Mi Objetivo Semanal</h3>
        <p class="frequency-subtitle">¿Cuántos días a la semana quieres estudiar?</p>
      </div>
    </div>

    <!-- Selector de días -->
    <div class="frequency-selector">
      <div class="days-counter">
        <button class="counter-btn" (click)="decreaseFrecuencia()" [disabled]="frecuenciaConfig.frecuenciaSemanal <= 1">
          <ion-icon name="remove-circle"></ion-icon>
        </button>
        
        <div class="counter-display">
          <span class="counter-number">{{ frecuenciaConfig.frecuenciaSemanal }}</span>
          <span class="counter-label">{{ frecuenciaConfig.frecuenciaSemanal === 1 ? 'día' : 'días' }} / semana</span>
        </div>
        
        <button class="counter-btn" (click)="increaseFrecuencia()" [disabled]="frecuenciaConfig.frecuenciaSemanal >= 7">
          <ion-icon name="add-circle"></ion-icon>
        </button>
      </div>
    </div>

    <!-- Opciones predefinidas -->
    <div class="frequency-presets">
      <button 
        class="preset-btn" 
        [class.active]="frecuenciaConfig.frecuenciaSemanal === 2"
        (click)="setFrecuencia(2)">
        2 días (Básico)
      </button>
      <button 
        class="preset-btn" 
        [class.active]="frecuenciaConfig.frecuenciaSemanal === 3"
        (click)="setFrecuencia(3)">
        3 días (Regular)
      </button>
      <button 
        class="preset-btn" 
        [class.active]="frecuenciaConfig.frecuenciaSemanal === 5"
        (click)="setFrecuencia(5)">
        5 días (Intensivo)
      </button>
      <button 
        class="preset-btn" 
        [class.active]="frecuenciaConfig.frecuenciaSemanal === 7"
        (click)="setFrecuencia(7)">
        Diario
      </button>
    </div>

    <!-- Progreso semanal -->
    <div class="weekly-progress" *ngIf="cumplimiento">
      <div class="progress-header">
        <span class="progress-label">Esta semana</span>
        <span class="progress-value">{{ cumplimiento.diasEstudiadosSemana }} / {{ cumplimiento.objetivoSemanal }} días</span>
      </div>
      <div class="progress-bar-container">
        <div class="progress-bar-fill" [style.width.%]="cumplimiento.porcentajeCumplimiento"></div>
      </div>
      <p class="progress-message" [class.success]="cumplimiento.porcentajeCumplimiento >= 100">
        <ion-icon [name]="cumplimiento.porcentajeCumplimiento >= 100 ? 'checkmark-circle' : 'time-outline'"></ion-icon>
        {{ getProgressMessage() }}
      </p>
    </div>

    <!-- Días preferidos (opcional) -->
    <div class="preferred-days">
      <h4>Días preferidos (opcional)</h4>
      <p class="preferred-days-subtitle">Selecciona los días que prefieres estudiar</p>
      
      <div class="days-grid">
        <button 
          *ngFor="let dia of diasSemana; let i = index"
          class="day-btn"
          [class.selected]="isDiaSelected(i)"
          (click)="toggleDia(i)"
          [disabled]="!isDiaSelected(i) && frecuenciaConfig.diasPreferidos.length >= frecuenciaConfig.frecuenciaSemanal">
          <span class="day-letter">{{ dia.substr(0, 1) }}</span>
          <span class="day-name">{{ dia }}</span>
        </button>
      </div>
    </div>

    <!-- Recordatorios -->
    <div class="reminder-config">
      <div class="reminder-toggle">
        <div class="reminder-info">
          <ion-icon name="notifications-outline"></ion-icon>
          <span>Recordatorios de estudio</span>
        </div>
        <ion-toggle 
          [(ngModel)]="frecuenciaConfig.recordatorioActivo"
          (ionChange)="onRecordatorioChange()">
        </ion-toggle>
      </div>

    <div class="reminder-time" *ngIf="frecuenciaConfig.recordatorioActivo">
      <label>Hora preferida</label>
      <div class="time-selector-container">
        <div class="time-selector">
          <select [(ngModel)]="horaSeleccionada" (change)="onHoraMinutoChange()" class="time-select hora">
            <option *ngFor="let h of horas" [value]="h">{{ h }}</option>
          </select>
          <span class="separator">:</span>
          <select [(ngModel)]="minutoSeleccionado" (change)="onHoraMinutoChange()" class="time-select minuto">
            <option *ngFor="let m of minutos" [value]="m">{{ m }}</option>
          </select>
        </div>
        <ion-icon name="time-outline" class="time-icon"></ion-icon>
      </div>
    </div>
    </div>

    <!-- Botón guardar -->
    <button class="save-frequency-btn" (click)="saveFrequency()" [disabled]="isSaving">
      <ion-icon name="save-outline"></ion-icon>
      {{ isSaving ? 'Guardando...' : 'Guardar Configuración' }}
    </button>

  </div>
</div>


    <div class="section">
      <h2 class="section-title">Progreso y Logros</h2>
      
      <div class="action-cards">
        <div class="action-card" (click)="viewHistory()">
          <div class="action-icon dashboard">
            <ion-icon name="stats-chart"></ion-icon>
          </div>
          <div class="action-text">
            <h3>Historial de Estudio</h3>
            <p>Ver todas tus sesiones</p>
          </div>
          <ion-icon name="chevron-forward" class="action-arrow"></ion-icon>
        </div>
        
        <div class="action-card" (click)="viewAchievements()">
          <div class="action-icon achievements">
            <ion-icon name="medal"></ion-icon>
          </div>
          <div class="action-text">
            <h3>Logros</h3>
            <p>{{ stats.racha_dias_maxima }} días - Mejor racha</p>
          </div>
          <ion-icon name="chevron-forward" class="action-arrow"></ion-icon>
        </div>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title">Configuración</h2>
      
      <div class="settings-card">
        <div class="setting-item action" (click)="editProfile()">
          <div class="setting-info">
            <ion-icon name="key"></ion-icon>
            <span>Cambiar contraseña</span>
          </div>
          <ion-icon name="chevron-forward"></ion-icon>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <ion-icon name="moon"></ion-icon>
            <span>Modo oscuro</span>
          </div>
          <ion-toggle 
            [(ngModel)]="settings.darkMode"
            (ionChange)="saveSettings()">
          </ion-toggle>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <ion-icon name="volume-high"></ion-icon>
            <span>Efectos de sonido</span>
          </div>
          <ion-toggle 
            [(ngModel)]="settings.soundEffects"
            (ionChange)="saveSettings()">
          </ion-toggle>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <ion-icon name="phone-portrait"></ion-icon>
            <span>Vibración</span>
          </div>
          <ion-toggle 
            [(ngModel)]="settings.vibration"
            (ionChange)="saveSettings()">
          </ion-toggle>
        </div>
      </div>
    </div>

    <div class="section">
      <h2 class="section-title">Ayuda</h2>
      
      <div class="help-buttons">
        <button class="help-btn" (click)="getHelp()">
          <ion-icon name="help-circle"></ion-icon>
          <span>Ayuda y Soporte</span>
        </button>
        
        <button class="help-btn" (click)="aboutApp()">
          <ion-icon name="information-circle"></ion-icon>
          <span>Acerca de Grado Cerrado</span>
        </button>
      </div>
    </div>

    <div class="section">
      <button class="logout-btn" (click)="logout()">
        <ion-icon name="log-out"></ion-icon>
        <span>Cerrar Sesión</span>
      </button>
    </div>

    <div class="bottom-spacer"></div>

  </div>

  <app-bottom-nav></app-bottom-nav>

</ion-content>